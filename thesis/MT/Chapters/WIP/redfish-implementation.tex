\section{Redfish Collector Integration}
\label{sec:redfish_collector}

\subsection{Purpose and Scope}
\label{subsec:redfish_purpose}

The Redfish collector retrieves chassis power readings from the Baseboard Management Controller at the global engine cadence.  
It performs exactly one Redfish query per tick, evaluates whether the returned value represents a new measurement, and emits either a fresh sample or a continuation sample.  
All results are timestamped with Tycho's monotonic clock and written into the shared ring buffer without further processing.

\subsection{Collector Mechanics and Data Flow}
\label{subsec:redfish_mechanics}

At each tick the collector issues one HTTP request to the BMC and extracts the current power value together with metadata such as the chassis identifier, sequence number, and BMC timestamp when present.  
If the request fails, the collector skips the tick without producing a sample.

The collector maintains the last observed sequence number for each chassis.  
If the newly retrieved sequence number differs from the previous one, the measurement is classified as fresh and is emitted immediately.  
If no new sequence has appeared, the collector applies a heartbeat policy to ensure continuity of the power time series.  
The heartbeat policy evaluates whether the time since the last fresh sample exceeds a configurable threshold.  
If so, the collector emits a continuation sample that repeats the most recent power value and updates its metadata accordingly.

Tycho supports two heartbeat modes.  
In fixed mode the heartbeat threshold is defined explicitly via configuration parameters.  
In auto mode the collector tracks the inter-arrival times of fresh Redfish updates and derives the heartbeat threshold from the median of a sliding window over these intervals, bounded by conservative limits.  
Polling frequency is unaffected by either mode and always follows the engine tick.

Each emitted sample is placed into a Redfish record containing the chassis identifier, power value, sequence number, BMC timestamp when provided, monotonic collection time, and freshness information.  
The freshness field records the difference between the BMC time and the monotonic collection time.  
Continuation samples recompute freshness using the last available BMC timestamp.

The resulting Redfish record is immutable and is written directly into Tycho's ring buffer.

\subsection{Collected Metrics}
\label{subsec:redfish_metrics}

The collector emits one record per chassis whenever a fresh measurement is detected or a heartbeat continuation is required.  
The fields exported in each record are listed in Table~\ref{tab:redfish-metrics}.

\begin{table}[h]
\centering
\begin{tabular}{p{3cm} p{1cm} p{9cm}}
\toprule
\textbf{Metric} & \textbf{Unit} & \textbf{Description} \\
\midrule
\multicolumn{3}{l}{\textit{Primary power metric}} \\[4pt]
\code{PowerWatts} & W & Instantaneous chassis power reported by the BMC. \\[4pt]

\multicolumn{3}{l}{\textit{Temporal and identity metadata}} \\[4pt]
\code{ChassisID} & - & Identifier of the chassis or enclosure. \\
\code{Seq} & - & Server-provided sequence number indicating new measurements. \\
\code{SourceTime} & s & Timestamp provided by the BMC, if available. \\
\code{CollectorTime} & s & Local collection time of the measurement. \\
\code{FreshnessMs} & ms & Difference between \code{SourceTime} and \code{CollectorTime}. \\
\bottomrule
\end{tabular}
\caption{Metrics collected by the Redfish collector.}
\label{tab:redfish-metrics}
\end{table}

Derived quantities such as energy are computed by downstream components and are not produced by the collector.

\subsection{Stability and Behaviour Across Chassis}
\label{subsec:redfish_stability}

The collector handles multiple chassis independently.  
Each chassis maintains its own sequence history, heartbeat state, and sliding window of update intervals when auto mode is active.  
The collector does not attempt to synchronise readings across chassis and emits records for each chassis as they become available.

Freshness values may vary significantly across platforms due to differences in BMC timestamp accuracy and publication delays.  
The collector records these values without modification.  
Continuation samples recompute freshness using the last reported BMC timestamp, allowing downstream components to identify stale or delayed data.

\subsection{Limitations}
\label{subsec:redfish_limitations}

The precision and update rate of Redfish measurements are determined entirely by the underlying BMC implementation.  
Most BMCs publish power data at low and irregular frequencies, and some may provide timestamps with limited resolution or drift.  
The collector does not correct or filter these behaviours and relies on downstream analysis to account for timestamp quality or coarse temporal resolution.  
Redfish provides total chassis power only and does not expose component-level breakdowns.

% \section{Redfish Collector Integration}
% \label{sec:redfish_collector}

% The Redfish collector retrieves node-level power measurements from the server's
% Baseboard Management Controller (BMC) through the Redfish API.  As an
% out-of-band source, it complements in-band telemetry such as RAPL by providing a
% hardware-validated view of total chassis power.  Tycho integrates these
% measurements into its global timing framework, ensuring that BMC-sourced data
% can be correlated with all other collectors using a common monotonic clock.

% \subsection{Overview and Objectives}
% \label{subsec:redfish_overview}

% Redfish power readings are updated asynchronously and often with vendor-specific
% timing behaviour.  
% Tycho therefore focuses on robustness, controlled polling, and precise
% timestamping rather than high-frequency sampling.  The collector executes a
% single BMC query at the global engine cadence, extracts the current chassis
% power value, and emits a sample only when necessary.  All readings are
% timestamped with Tycho's monotonic timebase and annotated with freshness
% metadata to express their temporal accuracy.

% \subsection{Baseline in Kepler}
% \label{subsec:redfish_baseline}

% Kepler's original Redfish integration consisted of a periodic background ticker
% that queried the BMC at fixed intervals, typically every sixty seconds.  It
% retrieved only instantaneous chassis power and made no distinction between new
% and repeated measurements.  No mechanism existed to detect stale data, associate
% readings with BMC timestamps, or align Redfish values with other collectors.
% The Redfish implementation was therefore sufficient for coarse system-power
% reporting, but not suitable for the finer temporal structure required by Tycho.

% \subsection{Refactoring and Tycho Extensions}
% \label{subsec:redfish_refactor}

% \subsubsection{Timing Ownership and Polling Control}
% \label{subsubsec:redfish_timing}

% Tycho removes Kepler's internal Redfish ticker entirely.  
% Polling is performed exclusively by Tycho's global timing engine, which invokes
% the collector once per engine tick.  This ensures that all Redfish interactions
% occur in lockstep with the rest of the measurement pipeline and that every
% sample can be aligned unambiguously with simultaneous energy and utilization
% values from other collectors.

% The polling frequency itself is never altered by the Redfish collector.
% Tycho maintains deterministic, externally selected polling intervals regardless
% of BMC behaviour.

% \subsubsection{Sequence-Based Newness Detection}
% \label{subsubsec:redfish_newness}

% Many BMCs return identical payloads for extended periods and only publish new
% power values intermittently.  To avoid emitting redundant samples, Tycho uses a
% per-chassis sequence number provided by the Redfish client.  Each measurement is considered fresh only when this sequence number differs from the one observed in the previous engine tick.

% No header-based (for example \code{ETag}) or value-delta heuristics are used.
% Newness is driven solely by this explicit sequence value, ensuring a consistent
% and vendor-agnostic update mechanism.

% \subsubsection{Heartbeat Mechanism and Freshness Metric}
% \label{subsubsec:redfish_heartbeat}

% Because BMC refresh cycles can be irregular, Tycho maintains a heartbeat window
% for each chassis.  If no new Redfish sample has appeared within this window, the
% collector emits a heartbeat sample that carries forward the last known power
% value.  This prevents gaps in the power time series while avoiding unnecessary
% fabrication of data.

% Each emitted sample includes a freshness metric, defined as the time difference
% between the BMC-reported timestamp (when available) and the local collection time.  This value quantifies the latency of the underlying Redfish pipeline.  
% Freshness does not influence newness detection; it is an informational quality
% indicator for the analysis layer.

% \subsubsection{Fixed vs Auto Heartbeat Mode}
% \label{subsubsec:redfish_autopoll}

% Tycho supports two Redfish operating modes, selected by
% \code{TYCHO\_REDFISH\_POLL\_AUTOTUNE}.  Both modes perform BMC polling strictly
% at the global engine cadence.

% In fixed mode, the heartbeat window is defined entirely by the user through
% \code{TYCHO\_REDFISH\_HEARTBEAT\_MS}.  
% This guarantees deterministic behaviour and is appropriate for reproducible
% benchmarks.

% In auto mode, Tycho adapts the heartbeat window to the BMC's observed update
% pattern.  
% Whenever a fresh sequence number is detected, the collector measures the
% inter-arrival duration to the previous update and stores it in a sliding window.
% The median of this window is taken as the representative publication period, and
% the heartbeat timeout is set to approximately \(1.5\) times this value, clamped
% between conservative bounds.  
% This technique aligns Tycho's emission behaviour with the hardware's natural
% update rhythm while retaining deterministic polling.

% \subsection{Collected Metrics}
% \label{subsec:redfish_metrics}

% The Redfish collector emits one record per chassis whenever a new measurement is detected or a heartbeat event occurs.  Each record is timestamped using Tycho's monotonic clock and annotated with metadata relevant for temporal correlation.
% Table~\ref{tab:redfish-metrics} summarises the collected fields.

% \begin{table}[h]
% \centering
% \begin{tabular}{p{3cm} p{1cm} p{9cm}}
% \toprule
% \textbf{Metric} & \textbf{Unit} & \textbf{Description} \\
% \midrule
% \multicolumn{3}{l}{\textit{Primary power metric}} \\[4pt]
% \code{PowerWatts} & W & Instantaneous chassis power reported by the BMC. \\[4pt]

% \multicolumn{3}{l}{\textit{Temporal and identity metadata}} \\[4pt]
% \code{ChassisID} & - & Identifier of the chassis or enclosure. \\
% \code{Seq} & - & Server-provided sequence number indicating new measurements. \\
% \code{SourceTime} & s & Timestamp provided by the BMC, if available. \\
% \code{CollectorTime} & s & Local collection time of the measurement. \\
% \code{FreshnessMs} & ms & Difference between \code{SourceTime} and \code{CollectorTime}. \\
% \bottomrule
% \end{tabular}
% \caption{Metrics collected by the Redfish collector.}
% \label{tab:redfish-metrics}
% \end{table}

% Energy values such as \code{EnergyMilliJ} are computed downstream by integrating the power series and are not directly produced by the collector.

% \subsection{Integration and Data Flow}
% \label{subsec:redfish_integration}

% The Redfish collector is a passive component within Tycho's unified collection
% pipeline.  At each engine tick it performs one BMC query, evaluates newness and
% heartbeat conditions, attaches monotonic timestamps, and writes the resulting
% record into a synchronized ring buffer.  
% No additional processing occurs within the collector; all energy computations
% and correlations across metrics are performed in Tycho's analysis stage.

% \subsection{Accuracy and Robustness Improvements}
% \label{subsec:redfish_accuracy}

% Tycho improves Redfish robustness by combining explicit sequence-based newness
% tracking, adaptive heartbeat windows, and freshness estimation.  
% Sequence tracking ensures that repeated BMC responses do not produce redundant
% samples.  
% Adaptive heartbeat windows accommodate BMCs with slow or irregular update
% cycles.  
% Freshness metadata exposes the latency of Redfish timestamps, allowing the
% analysis layer to assess the temporal reliability of each reading.

% These measures provide stable and chronologically consistent power telemetry
% across heterogeneous BMC implementations.

% \subsection{Limitations}
% \label{subsec:redfish_limitations}

% Redfish sampling remains limited by the update rate and timestamp quality of the underlying BMC.  Most implementations refresh power data at intervals on the order of one to two seconds.  Redfish does not report component-level power
% breakdowns; only total chassis power is available.  For fine-grained
% attribution, Tycho relies on complementary in-band collectors such as RAPL and
% eBPF.
